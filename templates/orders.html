<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ú–æ–∏ –∑–∞–∫–∞–∑—ã (–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä)</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .timer {
            font-weight: 500;
            color: #dc3545;
        }
    </style>
</head>
<body class="bg-light">

<div class="container mt-5 mb-5">
    <h2 class="text-center mb-4">üì¶ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞–º–∏</h2>

    <!-- –ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–∫–∞–∑—ã -->
    <h4 class="text-success mt-4 mb-3">üü¢ –ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–∫–∞–∑—ã</h4>
    {% if active_orders %}
        <div class="row g-4">
            {% for o in active_orders %}
            <div class="col-md-4">
                <div class="card shadow-sm border-success">
                    <div class="card-body text-center">
                        <h5 class="card-title">
                            {% if o.dish %}
                                {{ o.dish }}
                            {% elif o["items"] %}
                                {% for item in o["items"] %}
                                    {{ item.name }} √ó{{ item.quantity }}<br>
                                {% endfor %}
                            {% else %}
                                <em>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –±–ª—é–¥–∞—Ö</em>
                            {% endif %}
                        </h5>

                        {% if o.total %}
                            <p class="text-muted">–°—É–º–º–∞: {{ o.total }} —Å–æ–º</p>
                        {% endif %}

                        <span class="badge bg-success">{{ o.status }}</span><br>

                        {% if o.created_at %}
                            <p class="timer mt-2" id="timer-{{ o.id }}" data-created="{{ o.created_at }}">‚åõ —Å –º–æ–º–µ–Ω—Ç–∞ –∑–∞–∫–∞–∑–∞: ‚Äî</p>
                        {% endif %}

                        <!-- –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç "–≤—ã–¥–∞—Ç—å" –∑–∞–∫–∞–∑ -->
                        {% if o.status == '–ê–∫—Ç–∏–≤–µ–Ω' %}
                            {% if current_user is defined and current_user.role == 'Administrator' %}
                                <a href="{{ url_for('complete', order_id=o.id) }}" 
                                   class="btn btn-sm btn-outline-success mt-2">‚úÖ –í—ã–¥–∞—Ç—å</a>
                            {% endif %}
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    {% else %}
        <p class="text-muted">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤.</p>
    {% endif %}

    <!-- –ó–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ –∑–∞–∫–∞–∑—ã -->
    <h4 class="text-secondary mt-5 mb-3">‚ö™ –ó–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ –∑–∞–∫–∞–∑—ã</h4>
    {% if completed_orders %}
        <div class="row g-4">
            {% for o in completed_orders %}
            <div class="col-md-4">
                <div class="card shadow-sm border-secondary">
                    <div class="card-body text-center">
                        <h5 class="card-title">
                            {% if o.dish %}
                                {{ o.dish }}
                            {% elif o["items"] %}
                                {% for item in o["items"] %}
                                    {{ item.name }} √ó{{ item.quantity }}<br>
                                {% endfor %}
                            {% else %}
                                <em>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –±–ª—é–¥–∞—Ö</em>
                            {% endif %}
                        </h5>
                        <span class="badge bg-secondary">{{ o.status }}</span><br>
                        {% if o.completed_at %}
                            <small class="text-muted">üïí –ó–∞–≤–µ—Ä—à—ë–Ω: {{ o.completed_at.strftime("%H:%M:%S %d.%m.%Y") }}</small>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    {% else %}
        <p class="text-muted">–ù–µ—Ç –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤.</p>
    {% endif %}

    <div class="text-center mt-5">
        <a href="{{ url_for('dashboard') }}" class="btn btn-outline-dark px-4">‚Üê –ù–∞–∑–∞–¥ –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</a>
    </div>
</div>

<!-- JS –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–∞–π–º–µ—Ä–∞ -->
<script>
    function updateTimers() {
        document.querySelectorAll('.timer').forEach(timer => {
            const created = new Date(timer.dataset.created);
            const now = new Date();
            const diff = Math.floor((now - created) / 1000);
            const h = Math.floor(diff / 3600);
            const m = Math.floor((diff % 3600) / 60);
            const s = diff % 60;
            timer.textContent = `‚åõ —Å –º–æ–º–µ–Ω—Ç–∞ –∑–∞–∫–∞–∑–∞: ${h}—á ${m}–º ${s}—Å`;
        });
    }
    setInterval(updateTimers, 1000);
    updateTimers();
</script>

</body>
</html>
